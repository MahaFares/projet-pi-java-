{% extends 'BackOffice/base.html.twig' %}

{% block title %}Catégories d'Hébergement | EcoTrip Admin{% endblock %}
{% block page_title %}Gestion des Catégories{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
.cat-mgmt { font-family: 'Plus Jakarta Sans', sans-serif; }

.toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    align-items: center;
    margin-bottom: 24px;
}
.search-wrap {
    flex: 1;
    min-width: 250px;
    position: relative;
}
.search-wrap input {
    width: 100%;
    padding: 12px 16px 12px 44px;
    border: 1.5px solid #e2e8f0;
    border-radius: 12px;
    font-size: 0.95rem;
}
.search-wrap i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; }

.btn-add {
    padding: 12px 24px;
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
.btn-add:hover { color: white; opacity: 0.95; transform: translateY(-1px); transition: all 0.2s; }

.table-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.04);
}
.table-card table { width: 100%; border-collapse: collapse; }
.table-card th {
    padding: 16px 20px;
    text-align: left;
    font-weight: 600;
    font-size: 0.8rem;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
}
.table-card td {
    padding: 16px 20px;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
}
.table-card tr:hover td { background: #fafbfc; }

.btn-action {
    display: inline-flex; align-items: center; justify-content: center;
    width: 36px; height: 36px; border-radius: 10px;
    color: #64748b; text-decoration: none;
    transition: all 0.2s;
    background: #f8fafc;
}
.btn-action:hover { color: white; transform: translateY(-2px); }
.btn-action.edit:hover { background: #2563eb; }
.btn-action.view:hover { background: #10b981; }
.btn-action.delete:hover { background: #ef4444; }
.btn-action.delete { border: none; cursor: pointer; }
</style>
{% endblock %}

{% block body %}
<div class="container-fluid cat-mgmt py-4">
    <div class="toolbar">
        <div class="search-wrap">
            <i class="bi bi-search"></i>
            <input type="text" id="searchInput" name="q" value="{{ filters.q|default('') }}" placeholder="Rechercher une catégorie (nom, description)...">
        </div>
        <a href="{{ path('app_categorie_hebergement_new') }}" class="btn-add">
            <i class="bi bi-plus-lg"></i> Créer une Catégorie
        </a>
    </div>

    <div class="table-card">
        <table>
            <thead>
                <tr>
                    <th>Catégorie</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="categoryTableBody">
                {{ include('HebergementTemplate/categorie_hebergement/_table.html.twig') }}
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const tableBody = document.getElementById('categoryTableBody');
        let timeout = null;

        function fetchResults() {
            const q = searchInput.value;
            const params = new URLSearchParams({ q: q, ajax: '1' });

            tableBody.style.opacity = '0.6';

            fetch('{{ path('app_categorie_hebergement_index') }}?' + params.toString(), {
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.text())
            .then(html => {
                tableBody.innerHTML = html;
                tableBody.style.opacity = '1';
            })
            .catch(error => {
                console.error('Error:', error);
                tableBody.style.opacity = '1';
            });
        }

        searchInput.addEventListener('input', () => {
            clearTimeout(timeout);
            timeout = setTimeout(fetchResults, 300);
        });
    });
</script>
{% endblock %}
