{% extends 'base.html.twig' %}

{% block title %}Gestion des Transports{% endblock %}

{% block body %}
<div style="position: sticky; top: 0; background: white; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px 0;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="h2 mb-0"><i class="fa fa-car"></i> Gestion des Transports</h1>
            </div>
            <div class="col-md-4 text-end">
                <a href="{{ path('app_transport_new') }}" class="btn btn-success btn-lg">
                    <i class="fa fa-plus"></i> Ajouter un Transport
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container mt-4">
    <div class="mb-4">
        <form method="get" class="row g-2 align-items-end">
            <div class="col-md-3">
                <label class="form-label">Type</label>
                <input type="text" name="type" value="{{ filters.type|default('') }}" class="form-control" placeholder="Ex: Bus, Voiture">
            </div>
            <div class="col-md-2">
                <label class="form-label">Prix min (DT)</label>
                <input type="number" step="0.01" name="minPrice" value="{{ filters.minPrice is not null ? filters.minPrice : '' }}" class="form-control">
            </div>
            <div class="col-md-2">
                <label class="form-label">Prix max (DT)</label>
                <input type="number" step="0.01" name="maxPrice" value="{{ filters.maxPrice is not null ? filters.maxPrice : '' }}" class="form-control">
            </div>
            <div class="col-md-2">
                <label class="form-label">Capacité min</label>
                <input type="number" name="minCapacity" value="{{ filters.minCapacity is not null ? filters.minCapacity : '' }}" class="form-control">
            </div>
            <div class="col-md-2">
                <label class="form-label">Disponibilité</label>
                <select name="available" class="form-select">
                    <option value="">Tous</option>
                    <option value="1" {% if filters.available is same as(true) %}selected{% endif %}>Disponible</option>
                    <option value="0" {% if filters.available is same as(false) %}selected{% endif %}>Indisponible</option>
                </select>
            </div>
            <div class="col-md-1 d-grid">
                <button type="submit" class="btn btn-primary">Filtrer</button>
            </div>
        </form>
    </div>

    {% if transports %}
    <div class="table-responsive">
        <table class="table table-hover table-striped align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Image</th>
                    <th>Type</th>
                    <th>Capacité</th>
                    <th>Émission CO2</th>
                    <th>Prix</th>
                    <th>Statut</th>
                    <th style="width: 200px;">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for transport in transports %}
                <tr>
                    <td>
                        {% if transport.image %}
                            <img src="{{ asset('uploads/transports/' ~ transport.image) }}" alt="{{ transport.type }}" style="height: 60px; width: 60px; object-fit: cover; border-radius: 8px;">
                        {% else %}
                            <div style="height: 60px; width: 60px; background-color: #e9ecef; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="fa fa-image" style="color: #adb5bd;"></i>
                            </div>
                        {% endif %}
                    </td>
                    <td><strong>{{ transport.type }}</strong></td>
                    <td>{{ transport.capacite }} passagers</td>
                    <td>{{ transport.emissionco2 }} kg</td>
                    <td><strong>{{ transport.prixparpersonne }} DT</strong></td>
                    <td>
                        {% if transport.disponible %}
                            <span class="badge bg-success"><i class="fa fa-check"></i> Disponible</span>
                        {% else %}
                            <span class="badge bg-danger"><i class="fa fa-times"></i> Indisponible</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <a href="{{ path('app_transport_show', {'id': transport.id}) }}" class="btn btn-sm btn-info" title="Voir">
                                <i class="fa fa-eye"></i> Voir
                            </a>
                            <a href="{{ path('app_transport_edit', {'id': transport.id}) }}" class="btn btn-sm btn-warning" title="Modifier">
                                <i class="fa fa-edit"></i> Modifier
                            </a>
                            <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ transport.id }}" title="Supprimer">
                                <i class="fa fa-trash"></i> Supprimer
                            </button>
                        </div>
                    </td>
                </tr>

                <!-- Modal de confirmation pour la suppression -->
                <div class="modal fade" id="deleteModal{{ transport.id }}" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title"><i class="fa fa-warning"></i> Confirmer la suppression</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p>Êtes-vous sûr de vouloir supprimer le transport <strong>{{ transport.type }}</strong> ?</p>
                                <p class="text-muted">Cette action ne peut pas être annulée.</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                                <form method="post" action="{{ path('app_transport_delete', {'id': transport.id}) }}" style="display: inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ transport.id) }}">
                                    <button type="submit" class="btn btn-danger">
                                        <i class="fa fa-trash"></i> Supprimer
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center py-5">
        <h4><i class="fa fa-info-circle"></i> Aucun transport trouvé</h4>
        <p class="mb-3">Commencez par créer votre premier transport.</p>
        <a href="{{ path('app_transport_new') }}" class="btn btn-primary btn-lg">
            <i class="fa fa-plus"></i> Créer un Transport
        </a>
    </div>
    {% endif %}
</div>

<!-- Bootstrap JS pour les modals -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
